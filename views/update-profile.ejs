<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Update Profile</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/styles.css">
</head>

<body style="background-image: url(/img/03-04.jpg);">
  <div class="wrapper d-flex flex-column min-vh-100">
    <%- include('partials/navbar') %>
      <br />
      <div class="container">
        <div class="text-center mt-4 mb-2">
          <h3>Update Profile</h3>
          <small class="text-muted">Update profile details</small>
        </div>
        <form id="searchProfileForm" action="/api/searchProfile" method="GET">
          <div class="form-row">
            <div class="form-group col-md-4">
              <label for="serialNumber">Serial Number</label>
              <input type="text" class="form-control" id="serialNumber" name="serialNumber"
                placeholder="Enter Serial Number" required>
            </div>
            <div class="form-group col-md-4">
              <label>&nbsp;</label>
              <button type="submit" class="btn btn-primary btn-block">Search</button>
            </div>

          </div>
          <% if (typeof successMessage !=='undefined' ) { %>
            <div class="alert alert-success" role="alert">
              <%= successMessage %>
            </div>
            <% } %>


        </form>

        <!-- <form id="searchProfileForm" action="/api/searchProfile" method="GET">
  <label for="serialNumber">Serial Number:</label>
  <input 
    type="text" 
    id="serialNumber" 
    name="serialNumber" 
    value="<%= typeof serialNumber !== 'undefined' ? serialNumber : '' %>">
  <button type="submit">Search</button>
</form> -->
        <% if (profile) { %>
          <div id="updateFormContainer"> <!-- Add ID to the form container -->
            <form id="updateForm" action="/api/update-profile/<%= profile.id %>" method="POST">
              <div class="form-row">
                <div class="form-group col-md-4">
                  <label for="name">Name</label>
                  <input type="text" class="form-control" id="name" name="name" value="<%= profile.name %>" required>
                </div>
                <div class="form-group col-md-4">
                  <label for="gender">Gender</label>
                  <select class="form-control" id="gender" name="gender" required>
                    <option value="">Select Gender</option>
                    <option value="Male" <% if(profile.gender==='Male' ) { %> selected <% } %>>Male</option>
                    <option value="Female" <% if(profile.gender==='Female' ) { %> selected <% } %>>Female</option>
                  </select>
                </div>
                <div class="form-group col-md-4">
                  <label for="region">Region</label>
                  <select class="form-control" id="region" name="region" required>
                    <option value="">Select Region</option>
                    <option value="Chennai" <% if(profile.region==='Chennai' ) { %> selected <% } %>>Chennai</option>
                    <option value="Others(TN)" <% if(profile.region==='Others(TN)' ) { %> selected <% } %>>Others(TN)
                    </option>
                    <option value="Others(IND)" <% if(profile.region==='Others(IND)' ) { %> selected <% } %>>Others(IND)
                    </option>
                    <option value="Overseas" <% if(profile.region==='Overseas' ) { %> selected <% } %>>Overseas</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-4">
                  <label for="fatherName">Father's Name</label>
                  <input type="text" class="form-control" id="fatherName" name="fatherName"
                    value="<%= profile.father_name %>" required>
                </div>
                <div class="form-group col-md-4">
                  <label for="motherName">Mother's Name</label>
                  <input type="text" class="form-control" id="motherName" name="motherName"
                    value="<%= profile.mother_name %>" required>
                </div>
                <div class="form-group col-md-4">
                  <label for="siblings">Siblings</label>
                  <input type="text" class="form-control" id="siblings" name="siblings" value="<%= profile.siblings %>"
                    required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-4">
                  <label for="address">Address</label>
                  <input type="text" class="form-control" id="address" name="address" value="<%= profile.address %>"
                    required>
                </div>
                <div class="form-group col-md-4">
                  <label for="birthDate">Birth Date</label>
                  <input type="date" class="form-control" id="birthDate" name="birthDate"
                    value="<%= profile.birth_date && typeof profile.birth_date === 'string' ? profile.birth_date.slice(0, 10) : '' %>"
                    required>
                  <input type="hidden" id="birthDateHidden" name="birthDateHidden"
                    value="<%= profile.birth_date && typeof profile.birth_date === 'string' ? profile.birth_date.slice(0, 10) : '' %>">
                </div>
                <div class="form-group col-md-4">
                  <label for="birthTime">Birth Time</label>
                  <input type="time" class="form-control" id="birthTime" name="birthTime"
                    value="<%= profile.birth_time || '' %>" required>
                </div>`
              </div>
              <div class="form-row">
                <div class="form-group col-md-4">
                  <label for="birthPlace">Birth Place</label>
                  <input type="text" class="form-control" id="birthPlace" name="birthPlace"
                    value="<%= profile.birth_place %>">
                </div>
                <div class="form-group col-md-4">
                  <label for="jobDetails">Job Details</label>
                  <input type="text" class="form-control" id="jobDetails" name="jobDetails"
                    value="<%= profile.job_details %>" required>
                </div>
                <div class="form-group col-md-4">
                  <label for="monthlyIncome">Monthly Income</label>
                  <input type="number" class="form-control" id="monthlyIncome" name="monthlyIncome"
                    value="<%= profile.monthly_income %>" required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-4">
                  <label for="nakshatraid">Natchathiram</label>
                  <select id="nakshatraId" name="nakshatraid" class="form-control" required></select>
                </div>
                <div class="form-group col-md-4">
                  <label for="gothram">Gothram</label>
                  <input type="text" class="form-control" id="gothram" name="gothram" value="<%= profile.gothram %>"
                    required>
                </div>
                <div class="form-group col-md-4">
                  <label for="graduation">Graduation</label>
                  <select class="form-control" id="graduation" name="graduation" required>
                    <option value="">Select</option>
                    <option value="School" <% if(profile.qualification==='School' ) { %> selected <% } %>>School
                    </option>
                    <option value="Diploma" <% if(profile.qualification==='Diploma' ) { %> selected <% } %>>Diploma
                    </option>
                    <option value="UG" <% if(profile.qualification==='UG' ) { %> selected <% } %>>UG</option>
                    <option value="PG" <% if(profile.qualification==='PG' ) { %> selected <% } %>>PG</option>
                    <option value="PHD" <% if(profile.qualification==='PHD' ) { %> selected <% } %>>PHD</option>
                    <option value="Doctor" <% if(profile.qualification==='Doctor' ) { %> selected <% } %>>Doctor
                    </option>
                    <option value="Others" <% if(profile.qualification==='Others' ) { %> selected <% } %>>Others
                    </option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-4">
                  <label for="qualification_details">Qualification details</label>
                  <input type="text" class="form-control" id="qualification_details" name="qualification_details"
                    value="<%= profile.qualification_details %>" required>
                </div>
                <div class="form-group col-md-4">
                  <label for="contactNo">Contact No</label>
                  <input type="text" class="form-control" id="contactNo" name="contactNo"
                    value="<%= profile.contact_no %>" required>
                </div>
                <div class="form-group col-md-4">
                  <label for="additional_contact_no">Alternate Contact No</label>
                  <input type="text" class="form-control" id="additional_contact_no" name="additional_contact_no"
                    value="<%= profile.additional_contact_no %>">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group col-md-4">
                  <label for="rasiLagnam">Rasi(Lagnam)</label>
                  <select class="form-control" id="rasiLagnam" name="rasiLagnam" required>
                    <option value="">Select</option>
                    <option value="Suth" <% if(profile.rasi_lagnam==='Suth' ) { %> selected <% } %>>Suth
                    </option>
                    <option value="Sani" <% if(profile.rasi_lagnam==='Sani' ) { %> selected <% } %>>Sani
                    </option>
                    <option value="Sevai" <% if(profile.rasi_lagnam==='Sevai' ) { %> selected <% } %>>Sevai</option>
                    <option value="Raaghu/Kethu" <% if(profile.rasi_lagnam==='Raaghu/Kethu' ) { %> selected <% } %>
                        >Raaghu/Kethu</option>
                    <option value="Sani/Sevai" <% if(profile.rasi_lagnam==='Sani/Sevai' ) { %> selected <% } %>
                        >Sani/Sevai</option>
                    <option value="Sani/Kethu/Raaghu" <% if(profile.rasi_lagnam==='Sani/Kethu/Raaghu' ) { %> selected <%
                        } %>>Sani/Kethu/Raaghu
                    </option>
                    <option value="Sevai/Kethu/Raaghu" <% if(profile.rasi_lagnam==='Sevai/Kethu/Raaghu' ) { %>
                      selected <% } %>>Sevai/Kethu/Raaghu
                    </option>
                    <option value="Sani/Sevai/Kethu/Raaghu" <% if(profile.rasi_lagnam==='Sani/Sevai/Kethu/Raaghu' ) { %>
                      selected <% } %>>Sani/Sevai/Kethu/Raaghu
                    </option>
                  </select>
                </div>
                <div class="form-group col-md-4">
                  <label for="isActive">Is Active</label>
                  <input type="hidden" name="isActive" id="isActiveHidden" value="<%= profile.is_active %>">
                  <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" id="isActiveToggle" <% if(profile.is_active) {
                      %>
                    checked <% } %>>
                      <label class="custom-control-label" for="isActiveToggle"></label>
                  </div>
                </div>
                <div class="form-group col-md-4">
                  <label for="isRemarried">Is Remarried</label>
                  <input type="hidden" name="isRemarried" id="isRemarriedHidden" value="<%= profile.is_remarried %>">
                  <div class="custom-control custom-switch">
                    <input type="checkbox" class="custom-control-input" id="isRemarriedToggle" <%
                      if(profile.is_remarried) { %> checked <% } %>>
                      <label class="custom-control-label" for="isRemarriedToggle"></label>
                  </div>
                </div>


              </div>
              <div class="form-row">
                <div class="form-group col-md-12">
                  <button type="submit" class="btn btn-primary update-button">Update</button>
                </div>
              </div>
            </form>
          </div>
          <% } else if (searched) { %>
            <p>No profile found with the provided serial number.</p>
            <% } %>
      </div>
      <br />
      <br />
      <br />
      <%- include('partials/footer') %>
  </div>
  <!-- Bootstrap JS -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="/js/scripts.js"></script>
  <!-- <script>
    function validateForm() {
      const serialNumber = document.getElementById('serialNumber').value;
      if (serialNumber.trim() === '') {
        alert('Please enter Serial Number.');
        return false;
      }
      return true;
    }
    document.addEventListener('DOMContentLoaded', function () {
      const isActiveToggle = document.getElementById('isActiveToggle');
      const isActiveHidden = document.getElementById('isActiveHidden');

      isActiveToggle.addEventListener('change', function () {
        isActiveHidden.value = this.checked ? 'true' : 'false';
      });

      isRemarriedToggle.addEventListener('change', function () {
        isRemarriedHidden.value = this.checked ? 'true' : 'false';
      });

      // Preserve birth date value on form submission
      const birthDateInput = document.getElementById('birthDate');
      const birthDateHidden = document.getElementById('birthDateHidden');
      let initialBirthDateValue = birthDateInput.value;



      function validateUpdateForm() {
        const name = document.getElementById('name').value;
        const gender = document.getElementById('gender').value;
        const region = document.getElementById('region').value;
        const fatherName = document.getElementById('fatherName').value;
        const motherName = document.getElementById('motherName').value;
        const siblings = document.getElementById('siblings').value;
        const gothram = document.getElementById('gothram').value;
        const birthDate = document.getElementById('birthDate').value;
        const birthTime = document.getElementById('birthTime').value;
        const birthPlace = document.getElementById('birthPlace').value;
        const jobDetails = document.getElementById('jobDetails').value;
        const monthlyIncome = document.getElementById('monthlyIncome').value;
        const address = document.getElementById('address').value;
        const contactNo = document.getElementById('contactNo').value;
        const nakshatraid = document.getElementById('nakshatraid').value;
        const graduation = document.getElementById('graduation').value;
        const qualification_details = document.getElementById('qualification_details').value;
        const additional_contact_no = document.getElementById('additional_contact_no').value;
        const rasi_lagnam = document.getElementById('rasiLagnam').value;
        const navamsam_lagnam = document.getElementById('navamsamLagnam').value;

        if (name.trim() === '') {
          alert('Please enter Name.');
          return false;
        }
        if (gender.trim() === '') {
          alert('Please select Gender.');
          return false;
        }
        // Add validation for other fields as needed
        // ...
        //window.location.href = '/Matrimony';
        return true;
      }
      const profileNakshatraId = '<%= profile && profile.nakshatraid %>';
      fetch('/dropdown', {
        method: 'GET'
      })
        .then(response => response.json())
        .then(options => {
          const nakshatraId = document.getElementById('nakshatraId');
          options.forEach(option => {
            const optionElement = document.createElement('option');
            optionElement.value = option.id;
            optionElement.text = option.name;
            nakshatraId.add(optionElement);
            // Check if the option value matches the value from the database and select it
            if (option.id.toString().trim() === profileNakshatraId.trim()) {
              optionElement.selected = true;
            }
          });
        })
        .catch(error => console.error('Error fetching:', error));
    });
  </script> -->
  <script>
    // Validation for Search Form
    function validateSearchForm(e) {
      const serialNumber = document.getElementById('serialNumber').value;
      if (serialNumber.trim() === '') {
        e.preventDefault();
        alert('Please enter Serial Number.');
        return false;
      }
      return true;
    }

    // Validation for Update Form
    function validateUpdateForm(e) {
      const name = document.getElementById('name').value.trim();
      const gender = document.getElementById('gender').value.trim();
      const region = document.getElementById('region').value.trim();

      if (!name) {
        e.preventDefault();
        alert('Please enter Name.');
        return false;
      }
      if (!gender) {
        e.preventDefault();
        alert('Please select Gender.');
        return false;
      }
      if (!region) {
        e.preventDefault();
        alert('Please select Region.');
        return false;
      }

      // Add other field checks here if needed
      return true;
    }

    document.addEventListener('DOMContentLoaded', function () {
      // ===== SEARCH FORM =====
      const searchForm = document.getElementById('searchProfileForm');
      if (searchForm) {
        searchForm.addEventListener('submit', validateSearchForm);
      }

      // ===== UPDATE FORM =====
      const updateForm = document.getElementById('updateForm');
      if (updateForm) {
        updateForm.addEventListener('submit', validateUpdateForm);
      }

      // ===== TOGGLE SWITCHES =====
      const isActiveToggle = document.getElementById('isActiveToggle');
      const isActiveHidden = document.getElementById('isActiveHidden');
      if (isActiveToggle && isActiveHidden) {
        isActiveToggle.addEventListener('change', function () {
          isActiveHidden.value = this.checked ? 'true' : 'false';
        });
      }

      const isRemarriedToggle = document.getElementById('isRemarriedToggle');
      const isRemarriedHidden = document.getElementById('isRemarriedHidden');
      if (isRemarriedToggle && isRemarriedHidden) {
        isRemarriedToggle.addEventListener('change', function () {
          isRemarriedHidden.value = this.checked ? 'true' : 'false';
        });
      }

      // ===== NAKSHATRA DROPDOWN =====
      const profileNakshatraId = '<%= profile && profile.nakshatraid ? profile.nakshatraid : "" %>';
      const nakshatraSelect = document.getElementById('nakshatraId');
      if (nakshatraSelect) {
        fetch('/dropdown')
          .then(response => response.json())
          .then(options => {
            options.forEach(option => {
              const optionElement = document.createElement('option');
              optionElement.value = option.id;
              optionElement.text = option.name;
              if (option.id.toString().trim() === profileNakshatraId.trim()) {
                optionElement.selected = true;
              }
              nakshatraSelect.add(optionElement);
            });
          })
          .catch(error => console.error('Error fetching nakshatra list:', error));
      }
    });
  </script>

</body>

</html>