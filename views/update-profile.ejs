<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>கந்தன் சேவா சங்கம்</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="../css/styles.css">
  <style>
    footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      z-index: 1000;
    }
  </style>
</head>
<body style="background-image: url(../img/03-04.jpg);">

<nav class="navbar navbar-expand-md navbar-light">
  <div class="container">
    <img src="../img/KandhaLogo.png" style="height:5%;width: 5%;"/><a class="navbar-brand" href="#">கந்தன் சேவா சங்கம்</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
            <a class="nav-link" href="/Matrimony">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/Profile">Create Profile</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/Update-Profile">Update Profile</a>
          </li>
        <li class="nav-item">
          <button id="signoutButton" class="btn btn-danger">Sign Out</button>
        </li>
      </ul>
    </div>
  </div>
</nav>
<br/>
<div class="container">
    <h1>Update Profile</h1>
    <form id="updateProfileForm" action="/update" method="POST" onsubmit="return validateForm()">
      <div class="form-row">
        <div class="form-group col-md-4">
          <label for="serialNumber">Serial Number</label>
          <input type="text" class="form-control" id="serialNumber" name="serialNumber" placeholder="Enter Serial Number" required>
        </div>
        <div class="form-group col-md-4">
          <label>&nbsp;</label>
          <button type="submit" class="btn btn-primary btn-block">Search</button>
        </div>
        
      </div>
      <% if (typeof successMessage !== 'undefined') { %>
        <div class="alert alert-success" role="alert">
          <%= successMessage %>
        </div>
      <% } %>
      
      
    </form>
  
    <% if (profile) { %>
      <div id="updateFormContainer"> <!-- Add ID to the form container -->
      <form id="updateForm" action="/update-profile/<%= profile.id %>" method="POST" onsubmit="return validateUpdateForm()">
        <div class="form-row">
          <div class="form-group col-md-4">
            <label for="name">Name</label>
            <input type="text" class="form-control" id="name" name="name" value="<%= profile.name %>" required>
          </div>
          <div class="form-group col-md-4">
            <label for="gender">Gender</label>
            <select class="form-control" id="gender" name="gender" required>
              <option value="">Select Gender</option>
              <option value="Male" <% if(profile.gender === 'Male') { %> selected <% } %>>Male</option>
              <option value="Female" <% if(profile.gender === 'Female') { %> selected <% } %>>Female</option>
            </select>
          </div>
          <div class="form-group col-md-4">
            <label for="region">Region</label>
            <select class="form-control" id="region" name="region" required>
              <option value="">Select Region</option>
              <option value="Chennai" <% if(profile.region === 'Chennai') { %> selected <% } %>>Chennai</option>
              <option value="Others(TN)" <% if(profile.region === 'Others(TN)') { %> selected <% } %>>Others(TN)</option>
              <option value="Others(IND)" <% if(profile.region === 'Others(IND)') { %> selected <% } %>>Others(IND)</option>
              <option value="Overseas" <% if(profile.region === 'Overseas') { %> selected <% } %>>Overseas</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-4">
            <label for="fatherName">Father's Name</label>
            <input type="text" class="form-control" id="fatherName" name="fatherName" value="<%= profile.father_name %>" required>
          </div>
          <div class="form-group col-md-4">
            <label for="motherName">Mother's Name</label>
            <input type="text" class="form-control" id="motherName" name="motherName" value="<%= profile.mother_name %>" required>
          </div>
          <div class="form-group col-md-4">
            <label for="siblings">Siblings</label>
            <input type="text" class="form-control" id="siblings" name="siblings" value="<%= profile.siblings %>" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-4">
            <label for="address">Address</label>
            <input type="text" class="form-control" id="address" name="address" value="<%= profile.address %>" required>
          </div>
          <div class="form-group col-md-4">
            <label for="birthDate">Birth Date</label>
            <input type="date" class="form-control" id="birthDate" name="birthDate" value="<%= profile.birth_date && typeof profile.birth_date === 'string' ? profile.birth_date.slice(0, 10) : '' %>" required>
            <input type="hidden" id="birthDateHidden" name="birthDateHidden" value="<%= profile.birth_date && typeof profile.birth_date === 'string' ? profile.birth_date.slice(0, 10) : '' %>">
          </div>
          <div class="form-group col-md-4">
            <label for="birthTime">Birth Time</label>
            <input type="time" class="form-control" id="birthTime" name="birthTime" value="<%= profile.birth_time || '' %>" required>
          </div>`
        </div>
        <div class="form-row">
          <div class="form-group col-md-4">
            <label for="birthPlace">Birth Place</label>
            <input type="text" class="form-control" id="birthPlace" name="birthPlace" value="<%= profile.birth_place %>" >
          </div>
          <div class="form-group col-md-4">
            <label for="jobDetails">Job Details</label>
            <input type="text" class="form-control" id="jobDetails" name="jobDetails" value="<%= profile.job_details %>" required>
          </div>
          <div class="form-group col-md-4">
            <label for="monthlyIncome">Monthly Income</label>
            <input type="number" class="form-control" id="monthlyIncome" name="monthlyIncome" value="<%= profile.monthly_income %>" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group col-md-4">
            <label for="Natchathiram">Natchathiram</label>
            <select id="dropdown" name="Natchathiram" class="form-control" required></select>
          </div>
          <div class="form-group col-md-4">
            <label for="gothram">Gothram</label>
            <input type="text" class="form-control" id="gothram" name="gothram" value="<%= profile.gothram %>" required>
          </div>
          <div class="form-group col-md-4">
            <label for="graduation">Graduation</label>
            <select class="form-control" id="graduation" name="graduation" required>
              <option value="">Select</option>
              <option value="School" <% if(profile.qualification === 'School') { %> selected <% } %>>School</option>
              <option value="Diploma" <% if(profile.qualification === 'Diploma') { %> selected <% } %>>Diploma</option>
              <option value="UG" <% if(profile.qualification === 'UG') { %> selected <% } %>>UG</option>
              <option value="PG" <% if(profile.qualification === 'PG') { %> selected <% } %>>PG</option>
              <option value="PHD" <% if(profile.qualification === 'PHD') { %> selected <% } %>>PHD</option>
              <option value="Doctor" <% if(profile.qualification === 'Doctor') { %> selected <% } %>>Doctor</option>
              <option value="Others" <% if(profile.qualification === 'Others') { %> selected <% } %>>Others</option>        
          </select>
          </div>
          </div>
          <div class="form-row">
            <div class="form-group col-md-4">
              <label for="qualification_details">Qualification details</label>
              <input type="text" class="form-control" id="qualification_details" name="qualification_details" value="<%= profile.qualification_details %>" required>
            </div>
          <div class="form-group col-md-4">
            <label for="contactNo">Contact No</label>
            <input type="text" class="form-control" id="contactNo" name="contactNo" value="<%= profile.contact_no %>" required>
          </div>
          <div class="form-group col-md-4">
            <label for="additional_contact_no">Alternate Contact No</label>
            <input type="text" class="form-control" id="additional_contact_no" name="additional_contact_no" value="<%= profile.additional_contact_no %>" >
          </div>
          </div>
          <div class="form-row">
          <div class="form-group col-md-4">
            <label for="isActive">Is Active</label>
            <input type="hidden" name="isActive" id="isActiveHidden" value="<%= profile.is_active %>">
            <div class="custom-control custom-switch">
                <input type="checkbox" class="custom-control-input" id="isActiveToggle" <% if(profile.is_active) { %> checked <% } %>>
                <label class="custom-control-label" for="isActiveToggle"></label>
            </div>
          </div>
          <div class="form-group col-md-4">
            <label for="isRemarried">Is Remarried</label>
            <input type="hidden" name="isRemarried" id="isRemarriedHidden" value="<%= profile.is_remarried %>">
            <div class="custom-control custom-switch">
                <input type="checkbox" class="custom-control-input" id="isRemarriedToggle" <% if(profile.is_remarried) { %> checked <% } %>>
                <label class="custom-control-label" for="isRemarriedToggle"></label>
            </div>
          </div>
        </div>
       
        <div class="form-row">
          <div class="form-group col-md-12">
            <button type="submit" class="btn btn-primary update-button">Update</button>
          </div>
        </div>
      </form>
      </div>  
    <% } else if (searched) { %>
      <p>No profile found with the provided serial number.</p>
    <% } %>
</div>
<br/>
<br/>
<br/>   
<footer class="bg-danger text-white text-center py-3">
  <p>கந்தன் சேவா சங்கம் &copy; 2024</p>
</footer>

<!-- Bootstrap JS -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="../js/scripts.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
      const isActiveToggle = document.getElementById('isActiveToggle');
      const isActiveHidden = document.getElementById('isActiveHidden');
  
      isActiveToggle.addEventListener('change', function() {
          isActiveHidden.value = this.checked ? 'true' : 'false';
      });

      isRemarriedToggle.addEventListener('change', function() {
        isRemarriedHidden.value = this.checked ? 'true' : 'false';
      });      
  
      // Preserve birth date value on form submission
      const birthDateInput = document.getElementById('birthDate');
      const birthDateHidden = document.getElementById('birthDateHidden');
      let initialBirthDateValue = birthDateInput.value;
  
        function validateForm() {
          const serialNumber = document.getElementById('serialNumber').value;
          if (serialNumber.trim() === '') {
              alert('Please enter Serial Number.');
              return false;
          }
          return true;
      }
  
      function validateUpdateForm() {
          const name = document.getElementById('name').value;
          const gender = document.getElementById('gender').value;
          const region = document.getElementById('region').value;
          const fatherName = document.getElementById('fatherName').value;
          const motherName = document.getElementById('motherName').value;
          const siblings = document.getElementById('siblings').value;
          const gothram = document.getElementById('gothram').value;
          const birthDate = document.getElementById('birthDate').value;
          const birthTime = document.getElementById('birthTime').value;
          const birthPlace = document.getElementById('birthPlace').value;
          const jobDetails = document.getElementById('jobDetails').value;
          const monthlyIncome = document.getElementById('monthlyIncome').value;
          const address = document.getElementById('address').value;
          const contactNo = document.getElementById('contactNo').value;
          const Natchathiram = document.getElementById('Natchathiram').value;
          const graduation = document.getElementById('graduation').value;
          const qualification_details = document.getElementById('qualification_details').value;
  
          if (name.trim() === '') {
              alert('Please enter Name.');
              return false;
          }
          if (gender.trim() === '') {
              alert('Please select Gender.');
              return false;
          }
          // Add validation for other fields as needed
          // ...
          //window.location.href = '/Matrimony';
          return true;
      }
      const profileNakshatraId = '<%= profile && profile.nakshatraid %>';
      fetch('/dropdown', {
          method: 'GET'
      })
      .then(response => response.json())
      .then(options => {
          const dropdown = document.getElementById('dropdown');
          options.forEach(option => {
              const optionElement = document.createElement('option');
              optionElement.value = option.id;
              optionElement.text = option.name;
              dropdown.add(optionElement);
              // Check if the option value matches the value from the database and select it
              if (option.id.toString().trim() === profileNakshatraId.trim()) {
                  optionElement.selected = true;
              }
          });
      })
      .catch(error => console.error('Error fetching:', error));
  });
  </script>
  
</body>
</html>